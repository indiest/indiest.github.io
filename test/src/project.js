require=function o(r,a,c){function h(t,e){if(!a[t]){if(!r[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}var n=a[t]={exports:{}};r[t][0].call(n.exports,function(e){return h(r[t][1][e]||e)},n,n.exports,o,r,a,c)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<c.length;e++)h(c[e]);return h}({Game:[function(e,t,i){"use strict";cc._RF.push(t,"14debfGvKhNC6h9Wm/mFSSl","Game");var s=cc.Enum({NotStarted:0,Playing:1,GameOver:2}),n=cc.Class({extends:cc.Component,statics:{instance:null},properties:{playerNode:{default:null,type:cc.Node},treePrefab:{default:null,type:cc.Prefab},treesRoot:{default:null,type:cc.Node},treeStartDensity:.02,treeDensityInc:.002,treeScaleMin:.8,treeScaleMax:1,speedScoreFactor:.1,trailsRoot:{default:null,type:cc.Node},trailPrefab:{default:null,type:cc.Prefab},bonusScorePrefab:{default:null,type:cc.Prefab},state:{default:s.NotStarted,type:cc.Enum(s)},mainMenu:{default:null,type:cc.Node},highScoreLabel:{default:null,type:cc.Label},scoreLabel:{default:null,type:cc.Label},camera:{default:null,type:cc.Camera},bgMusic:{default:null,type:cc.AudioSource},clickSound:{default:null,url:cc.AudioClip},snowSound:{default:null,url:cc.AudioClip},scoreSounds:{default:[],url:cc.AudioClip},gameOverSound:{default:null,url:cc.AudioClip}},player:null,treeDensity:0,score:0,highScore:0,trailPool:null,_trailDelta:0,screenWidth:function(){return cc.Canvas.instance.designResolution.width},screenHeight:function(){return cc.Canvas.instance.designResolution.height},onLoad:function(){n.instance=this},start:function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchScreen,this),this.player=this.playerNode.getComponent("Player"),this.trailsRoot.setSiblingIndex(0),this.playerNode.setSiblingIndex(1),this.treesRoot.setSiblingIndex(2),this.trailPool=new cc.NodePool;for(var e=0;e<200;e++)this.trailPool.put(cc.instantiate(this.trailPrefab));this.highScore=0,this.scoreLabel.string="",this.initGame()},initGame:function(){this.mainMenu.active=!0,this.bgMusic.rewind(),this.playerNode.x=0,this.playerNode.zIndex=-this.playerNode.y,this.player.reset(),this.player.enabled=!1;for(var e=0,t=.5*-this.screenHeight();t<0&&!(cc.random0To1()<this.treeStartDensity&&(this.createTree(t),10<=++e));t++);this.treeDensity=this.treeStartDensity,this.score=0,this.highScoreLabel.string=this.highScore.toString(),this._trailDelta=0,this.state=s.NotStarted},createTree:function(e){var t=cc.instantiate(this.treePrefab);t.parent=this.treesRoot,t.x=this.screenWidth()*(.5-cc.random0To1()),t.y=e-t.height-this.treesRoot.y,t.scaleX=t.scaleY=cc.random0To1()*(this.treeScaleMax-this.treeScaleMin)+this.treeScaleMin,t.zIndex=-t.y},update:function(e){if(this.state==s.Playing){if(this.playerNode.x+=this.player.curSpeedX*e,this.playerNode.x>.5*this.screenWidth()?this.gameOver():this.playerNode.x<-.5*this.screenWidth()&&this.gameOver(),this._trailDelta<=0){this.trailPool.size()<=0&&this.trailPool.put(this.trailsRoot.children[0]);var t=this.trailPool.get();t.parent=this.trailsRoot,t.x=this.playerNode.x+4*(cc.random0To1()-1),t.y=this.playerNode.y-this.treesRoot.y+this.playerNode.height,t.zIndex=-t.y,this._trailDelta=2}var i=this.player.speedY*e;this.treesRoot.y+=i,this.trailsRoot.y+=i,this._trailDelta-=i,this.treeDensity+=this.treeDensityInc*e,cc.random0To1()<this.treeDensity&&this.createTree(-.5*this.screenHeight()),this.score+=this.player.speedY*this.speedScoreFactor*e,this.scoreLabel.string=Math.round(this.score).toString()}},onTouchScreen:function(e){this.state==s.NotStarted?(this.mainMenu.active=!1,this.player.enabled=!0,this.state=s.Playing,cc.audioEngine.play(this.clickSound,!1,1)):this.state==s.Playing&&(this.player.changeDir(),cc.audioEngine.play(this.snowSound,!1,1))},onBonusScore:function(e){this.score+=e.bonusFactor;var t=cc.instantiate(this.bonusScorePrefab);t.parent=this.treesRoot,t.x=e.node.x,t.y=e.node.y,t.zIndex=1e3,t.getComponent(cc.Label).string="+"+e.bonusFactor;var i=Math.floor(cc.random0To1()*this.scoreSounds.length);cc.audioEngine.play(this.scoreSounds[i],!1,1)},gameOver:function(){cc.audioEngine.play(this.gameOverSound,!1,1),this.state=s.GameOver,this.highScore<this.score&&(this.highScore=Math.round(this.score),this.scoreLabel.string="新的记录！"),this.player.die()},finish:function(){this.treesRoot.removeAllChildren(!0);for(var e=0;e<this.trailsRoot.childrenCount;e++)this.trailPool.put(this.trailsRoot.children[e]);this.trailsRoot.removeAllChildren(),this.initGame()}});t.exports=n,cc._RF.pop()},{}],Player:[function(e,t,i){"use strict";cc._RF.push(t,"96f77Jj2TFHqo/qvFfuu2D9","Player");var s=e("Game");cc.Class({extends:cc.Component,properties:{maxSpeedX:2,curSpeedX:0,timeToMaxSpeedX:.5,changeDirSpeedScale:.5,startSpeedY:3,deltaSpeedY:.1,speedY:0},isDead:!1,onLoad:function(){},reset:function(){this.isDead=!1,this.node.getComponent(cc.Animation).play("PlayerDefault"),this.curSpeedX=0,this.maxSpeedX=Math.abs(this.maxSpeedX),this.speedY=this.startSpeedY},update:function(e){this.isDead||(.1<Math.abs(this.maxSpeedX-this.curSpeedX)&&(this.curSpeedX+=this.maxSpeedX*e/this.timeToMaxSpeedX),this.speedY+=this.deltaSpeedY*e)},changeDir:function(){this.curSpeedX*=this.changeDirSpeedScale,this.maxSpeedX=-this.maxSpeedX},onCollisionEnter:function(e,t){s.instance.gameOver()},die:function(){this.node.getComponent(cc.Animation).play("PlayerDie"),this.node.getComponentInChildren(cc.ParticleSystem).resetSystem(),this.isDead=!0},onDead:function(){s.instance.finish()}});cc._RF.pop()},{Game:"Game"}],Tree:[function(e,t,i){"use strict";cc._RF.push(t,"84e49TNCF5NJ64X4X8JA0RI","Tree");var r=e("Game");cc.Class({extends:cc.Component,properties:{hitNode:{default:null,type:cc.Node},hitDist:10,bonusDist:20,bonusFactor:10},gaveBonus:!1,start:function(){},update:function(e){var t=r.instance.player,i=cc.v2(this.hitNode.x+this.node.x+this.node.parent.x,this.hitNode.y+this.node.y+this.node.parent.y),s=t.node.x-i.x,n=t.node.y-i.y,o=Math.sqrt(s*s+n*n);if(o<=this.hitDist)return t.onCollisionEnter(this.node,t.node),void(this.enabled=!1);!this.gaveBonus&&n<-this.hitDist&&o<this.bonusDist&&(r.instance.onBonusScore(this),this.node.runAction(cc.scaleTo(.2,1,1.2)),this.gaveBonus=!0),this.node.y+this.node.parent.y>cc.Canvas.instance.designResolution.height&&this.node.destroy()}}),cc._RF.pop()},{Game:"Game"}]},{},["Game","Player","Tree"]);